var MUB={_uid:0,_minRoot:"/min/?",checkRewrite:function(){var b=location.pathname.replace(/\/[^\/]*$/,"/rewriteTest.js").substr(1);function a(){$("#minRewriteFailed")[0].className="topNote"}$.ajax({url:"../f="+b+"&"+(new Date()).getTime(),success:function(c){if(c==="1"){MUB._minRoot="/min/";$("span.minRoot").html("/min/")}else{a()}},error:a})},newLi:function(){return'<li id="li'+MUB._uid+'">http://'+location.host+'/<input type=text size=20> <button title="Remove">x</button> <button title="Include Earlier">&uarr;</button> <button title="Include Later">&darr;</button> <span></span></li>'},addLi:function(){$("#sources").append(MUB.newLi());var a=$("#li"+MUB._uid)[0];$("button[title=Remove]",a).click(function(){$("#results").hide();var b=!!$("input",a)[0].value;$(a).remove()});$("button[title$=Earlier]",a).click(function(){$(a).prev("li").find("input").each(function(){$("#results").hide();var b=this.value;this.value=$("input",a).val();$("input",a).val(b);MUB.updateAllTestLinks()})});$("button[title$=Later]",a).click(function(){$(a).next("li").find("input").each(function(){$("#results").hide();var b=this.value;this.value=$("input",a).val();$("input",a).val(b);MUB.updateAllTestLinks()})});++MUB._uid},liUpdateTestLink:function(){if(!$("input",this)[0].value){return}var a=this;$("span",this).html("");var b="http://"+location.host+"/"+$("input",this)[0].value.replace(/^\//,"");$.ajax({url:b,complete:function(d,c){if("success"==c){$("span",a).html("&#x2713;")}else{$("span",a).html("<button><b>404! </b> recheck</button>").find("button").click(function(){MUB.liUpdateTestLink.call(a)})}},dataType:"text"})},updateAllTestLinks:function(){$("#sources li").each(MUB.liUpdateTestLink)},getCommonCharAtPos:function(a,f){var d,b=a.length,e=a[0].charAt(f);if(e===""||b===1){return e}for(d=1;d<b;++d){if(a[d].charAt(f)!==e){return""}}return e},getBestUri:function(a){var j=0,b="",h;while(true){h=MUB.getCommonCharAtPos(a,j);if(h===""){break}else{b+=h}++j}b=b.replace(/[^\/]+$/,"");var d=MUB._minRoot+"f="+a.join(",");if(b.charAt(b.length-1)==="/"){var k=a,f,e=a.length;for(f=0;f<e;++f){k[f]=a[f].substr(b.length)}b=b.substr(0,b.length-1);var g=MUB._minRoot+"b="+b+"&f="+k.join(",");d=d.length<g.length?d:g}return d},update:function(){MUB.updateAllTestLinks();var c=[],d=false,b=false;$("#sources input").each(function(){var f,h;if(!b&&this.value&&(f=this.value.match(/\.(css|js)$/))){var g=f[1];if(d===false){d=g}else{if(g!==d){b=true;return alert("extensions must match!")}}this.value=this.value.replace(/^\//,"");if(-1!=$.inArray(this.value,c)){b=true;return alert("duplicate file!")}c.push(this.value)}});if(b||!c.length){return}$("#groupConfig").val("    'keyName' => array('//"+c.join("', '//")+"'),");var e=MUB.getBestUri(c),a=e.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/&/,"&amp;");$("#uriA").html(a)[0].href=e;$("#uriHtml").val(d==="js"?'<script type="text/javascript" src="'+a+'"><\/script>':'<link type="text/css" rel="stylesheet" href="'+a+'" />');$("#results").show()},addButtonClick:function(){$("#results").hide();MUB.addLi();MUB.updateAllTestLinks();$("#update").show().click(MUB.update);$("#sources li:last input")[0].focus()},init:function(){$("#app").show();$("#sources").html("");$("#add button").click(MUB.addButtonClick);$("#uriHtml, #groupConfig").click(function(){this.select()}).focus(function(){this.select()});$("a.ext").attr({target:"_blank"});if(location.hash){$("#getBm").hide();$("#bmUris").html("<p><strong>Found by bookmarklet:</strong> /<a href=#>"+location.hash.substr(1).split(",").join("</a> | /<a href=#>")+"</a></p>");$("#bmUris a").click(function(){MUB.addButtonClick();$("#sources li:last input").val(this.innerHTML);MUB.liUpdateTestLink.call($("#sources li:last")[0]);$("#results").hide();return false}).attr({title:"Add file +"})}else{var a=location.pathname.replace(/\/[^\/]*$/,"/bm.js").substr(1);$.ajax({url:"../?f="+a,success:function(b){$("#bm")[0].href=b.replace("%BUILDER_URL%",location.href).replace(/\n/g," ")},dataType:"text"});$.browser.msie&&$("#getBm p:last").append(" Sorry, not supported in MSIE!");MUB.addButtonClick()}MUB.checkRewrite()}};window.onload=MUB.init;